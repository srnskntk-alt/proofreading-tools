<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校正ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1f2937;
            font-size: 2.25rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .highlight {
            background-color: #fca5a5;
            color: #b91c1c;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 4px;
        }
        textarea {
            resize: vertical;
            min-height: 200px;
            font-size: 1rem;
        }
        button {
            transition: all 0.2s ease-in-out;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .pill {
            display: inline-block;
            background-color: #e0e7ff;
            color: #4338ca;
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 4px;
        }
        .delete-btn {
            margin-left: 8px;
            font-weight: bold;
            color: #9333ea;
            cursor: pointer;
            transition: color 0.2s;
        }
        .delete-btn:hover {
            color: #c084fc;
        }
        .toggle-btn {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
        }
        .toggle-icon {
            margin-left: 8px;
            transition: transform 0.2s;
        }
        .toggle-icon.open {
            transform: rotate(90deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>文章校正ツール</h1>
        <p class="text-gray-600 mb-6 text-center">文章の表記ゆれを検出し、ハイライト表示します。</p>

        <!-- Term addition form -->
        <div class="mb-8 p-6 bg-gray-50 border border-gray-200 rounded-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800 toggle-btn" onclick="toggleTerms()">
                用語の登録・管理
                <span id="toggleIcon" class="toggle-icon">&#9654;</span>
            </h2>
            <div id="termSection" class="hidden">
                <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4 mb-4">
                    <input type="text" id="termInput" placeholder="例: 時々" class="flex-grow p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                    <input type="text" id="replacementInput" placeholder="推奨表記 (任意): ときどき" class="flex-grow p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                    <button onclick="addTerm()" class="w-full sm:w-auto px-6 py-3 bg-purple-600 text-white font-bold rounded-full hover:bg-purple-700">用語を登録</button>
                </div>
                <p class="text-sm text-gray-500 mb-4">推奨表記は任意です。例えば、「時々」を「ときどき」と表記したい場合、「時々」を登録し、推奨表記に「ときどき」と入力します。省略した場合、ハイライトのみ行います。</p>
                <div id="termsList" class="flex flex-wrap items-center mt-2">
                    <!-- Registered terms will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Main text check form -->
        <div class="mb-8">
            <h2 class="text-xl font-bold mb-4 text-gray-800">文章の校正</h2>
            <textarea id="inputText" class="w-full p-4 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500"></textarea>
            <button onclick="proofreadText()" class="w-full mt-4 px-6 py-3 bg-indigo-600 text-white font-bold rounded-full hover:bg-indigo-700">校正を実行</button>
        </div>

        <!-- Result display section -->
        <div>
            <h2 class="text-xl font-bold mb-4 text-gray-800">校正結果</h2>
            <div id="resultOutput" class="p-6 border border-gray-300 rounded-md bg-white leading-relaxed">
                ここに校正結果が表示されます。
            </div>
        </div>
    </div>

    <script>
        const inputTextarea = document.getElementById('inputText');
        const resultOutput = document.getElementById('resultOutput');
        const termInput = document.getElementById('termInput');
        const replacementInput = document.getElementById('replacementInput');
        const termsList = document.getElementById('termsList');
        const termSection = document.getElementById('termSection');
        const toggleIcon = document.getElementById('toggleIcon');

        let terms = [];

        // Load terms from local storage on page load
        document.addEventListener('DOMContentLoaded', () => {
            const storedTerms = localStorage.getItem('proofreadingTerms');
            if (storedTerms) {
                terms = JSON.parse(storedTerms);
                renderTerms();
            }
        });

        // Add a new term
        function addTerm() {
            const term = termInput.value.trim();
            const replacement = replacementInput.value.trim();

            if (term) {
                terms.push({ term, replacement });
                termInput.value = '';
                replacementInput.value = '';
                saveTerms();
                renderTerms();
            }
        }

        // Save terms to local storage
        function saveTerms() {
            localStorage.setItem('proofreadingTerms', JSON.stringify(terms));
        }

        // Render registered terms
        function renderTerms() {
            termsList.innerHTML = '';
            terms.forEach((t, index) => {
                const termPill = document.createElement('span');
                termPill.className = 'pill';
                termPill.innerHTML = `${t.term}${t.replacement ? ` → ${t.replacement}` : ''} <span class="delete-btn" data-index="${index}">&times;</span>`;
                termsList.appendChild(termPill);
            });
        }

        // Handle term deletion
        termsList.addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-btn')) {
                const index = event.target.dataset.index;
                terms.splice(index, 1);
                saveTerms();
                renderTerms();
            }
        });

        // Toggle the visibility of the term section
        function toggleTerms() {
            termSection.classList.toggle('hidden');
            toggleIcon.classList.toggle('open');
        }

        // Main proofreading function
        function proofreadText() {
            let text = inputTextarea.value;
            let highlightedText = text;

            if (text.trim() === '') {
                resultOutput.innerHTML = '<span class="text-red-500">テキストを入力してください。</span>';
                return;
            }

            // Create a regular expression to find the terms
            const termsToMatch = terms.map(t => escapeRegExp(t.term)).join('|');
            if (!termsToMatch) {
                resultOutput.innerHTML = '用語が登録されていません。';
                return;
            }

            const regex = new RegExp(`(${termsToMatch})`, 'g');
            
            // Replace found terms with a highlighted version
            highlightedText = highlightedText.replace(regex, (match) => {
                return `<span class="highlight">${match}</span>`;
            });
            
            resultOutput.innerHTML = highlightedText;
        }

        // Helper function to escape special characters in a string for use in a regular expression
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
    </script>
</body>
</html>